# ğŸ› ï¸ NOFX è¿ç»´æ–‡æ¡£

**Language:** [ä¸­æ–‡](è¿ç»´æ–‡æ¡£.md) | [English](ops-guide.md)

æœ¬æ–‡æ¡£æä¾› NOFX AI äº¤æ˜“ç³»ç»Ÿçš„ç”Ÿäº§ç¯å¢ƒè¿ç»´æŒ‡å—ï¼ŒåŒ…æ‹¬éƒ¨ç½²ã€ç›‘æ§ã€å®‰å…¨ã€å¤‡ä»½ã€æ•…éšœæ’æŸ¥ç­‰å…¨æ–¹ä½è¿ç»´å†…å®¹ã€‚

## ğŸ“‹ ç›®å½•

- [ç¯å¢ƒè¦æ±‚](#ç¯å¢ƒè¦æ±‚)
- [éƒ¨ç½²æ–¹æ¡ˆ](#éƒ¨ç½²æ–¹æ¡ˆ)
- [ç«¯å£å®‰å…¨ç­–ç•¥](#ç«¯å£å®‰å…¨ç­–ç•¥)
- [ç³»ç»Ÿç›‘æ§](#ç³»ç»Ÿç›‘æ§)
- [æ•°æ®å¤‡ä»½](#æ•°æ®å¤‡ä»½)
- [æ—¥å¿—ç®¡ç†](#æ—¥å¿—ç®¡ç†)
- [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)
- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
- [å®‰å…¨åŠ å›º](#å®‰å…¨åŠ å›º)
- [ç»´æŠ¤è®¡åˆ’](#ç»´æŠ¤è®¡åˆ’)

## ğŸ¯ ç¯å¢ƒè¦æ±‚

### ç¡¬ä»¶è¦æ±‚

| ç»„ä»¶ | æœ€ä½é…ç½® | æ¨èé…ç½® |
|------|----------|----------|
| CPU | 2æ ¸ | 4æ ¸+ |
| å†…å­˜ | 4GB | 8GB+ |
| å­˜å‚¨ | 20GB | 100GB+ SSD |
| ç½‘ç»œ | ç¨³å®šè¿æ¥ | ä½å»¶è¿Ÿç½‘ç»œ |

### è½¯ä»¶è¦æ±‚

```bash
# åŸºç¡€ç¯å¢ƒ
- Docker 20.10+
- Docker Compose 2.0+
- Git 2.0+

# å¯é€‰ï¼ˆPM2éƒ¨ç½²ï¼‰
- Go 1.19+
- Node.js 16+
- PM2 5.0+
```

## ğŸš€ éƒ¨ç½²æ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šDocker ç”Ÿäº§éƒ¨ç½²ï¼ˆæ¨èï¼‰

#### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/tinkle-community/nofx.git
cd nofx

# å¤åˆ¶é…ç½®æ–‡ä»¶
cp config.example.jsonc config.json
cp .env.example .env
```

#### 1.5. å…¬ç½‘éƒ¨ç½²å®‰å…¨é…ç½®ï¼ˆé‡è¦ï¼ï¼‰

**âš ï¸ å¦‚æœæ˜¯å…¬ç½‘éƒ¨ç½²ï¼Œå¿…é¡»æ‰§è¡Œä»¥ä¸‹å®‰å…¨é…ç½®ï¼š**

```bash
# 1. ç”Ÿæˆå¼ºJWTå¯†é’¥
JWT_SECRET=$(openssl rand -base64 64)
echo "ç”Ÿæˆçš„JWTå¯†é’¥: $JWT_SECRET"

# 2. ä¿®æ”¹config.json
cat > config.json << EOF
{
  "admin_mode": false,
  "jwt_secret": "$JWT_SECRET",
  "api_server_port": 8080,
  "beta_mode": false
}
EOF

# 3. éªŒè¯é…ç½®
echo "æ£€æŸ¥é…ç½®æ–‡ä»¶ï¼š"
jq . config.json

# 4. è¿è¡Œå®‰å…¨æ£€æŸ¥
curl -s https://raw.githubusercontent.com/tinkle-community/nofx/main/docs/è¿ç»´æ–‡æ¡£.md | grep -A 50 "å…¬ç½‘å®‰å…¨æ£€æŸ¥è„šæœ¬" > /tmp/security_check.sh
chmod +x /tmp/security_check.sh
/tmp/security_check.sh
```

#### 2. ç”Ÿäº§ç¯å¢ƒé…ç½®

```bash
# ç¼–è¾‘ .env æ–‡ä»¶
nano .env
```

```env
# .env ç”Ÿäº§é…ç½®
NOFX_BACKEND_PORT=18080          # åç«¯ç«¯å£
NOFX_FRONTEND_PORT=13000         # å‰ç«¯ç«¯å£
NOFX_TIMEZONE=Asia/Shanghai      # æ—¶åŒº
```

#### 3. Docker Compose ç”Ÿäº§é…ç½®

åˆ›å»º `docker-compose.prod.yml`:

```yaml
version: '3.8'

services:
  # åç«¯æœåŠ¡
  nofx:
    build:
      context: .
      dockerfile: ./docker/Dockerfile.backend
    container_name: nofx-trading
    restart: unless-stopped
    # åªç»‘å®šæœ¬åœ°å›ç¯åœ°å€
    ports:
      - "127.0.0.1:${NOFX_BACKEND_PORT:-18080}:8080"
    volumes:
      - ./config.json:/app/config.json:ro
      - ./config.db:/app/config.db
      - ./decision_logs:/app/decision_logs
      - ./prompts:/app/prompts
      - /etc/localtime:/etc/localtime:ro
      # å¤‡ä»½ç›®å½•
      - ./backups:/app/backups
    environment:
      - TZ=${NOFX_TIMEZONE:-Asia/Shanghai}
    networks:
      - nofx-internal
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    # èµ„æºé™åˆ¶
    deploy:
      resources:
        limits:
          memory: 2G
          cpus: '1.0'
        reservations:
          memory: 512M
          cpus: '0.5'

  # å‰ç«¯æœåŠ¡
  nofx-frontend:
    build:
      context: .
      dockerfile: ./docker/Dockerfile.frontend
    container_name: nofx-frontend
    restart: unless-stopped
    ports:
      - "127.0.0.1:${NOFX_FRONTEND_PORT:-13000}:80"
    networks:
      - nofx-internal
    depends_on:
      - nofx
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: '0.5'

  # ç›‘æ§æœåŠ¡ï¼ˆå¯é€‰ï¼‰
  prometheus:
    image: prom/prometheus:latest
    container_name: nofx-prometheus
    restart: unless-stopped
    ports:
      - "127.0.0.1:9090:9090"
    volumes:
      - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus_data:/prometheus
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
      - '--web.console.libraries=/etc/prometheus/console_libraries'
      - '--web.console.templates=/etc/prometheus/consoles'
      - '--storage.tsdb.retention.time=200h'
      - '--web.enable-lifecycle'
    networks:
      - nofx-internal

  # æ—¥å¿—æ”¶é›†ï¼ˆå¯é€‰ï¼‰
  grafana:
    image: grafana/grafana:latest
    container_name: nofx-grafana
    restart: unless-stopped
    ports:
      - "127.0.0.1:3001:3000"
    volumes:
      - grafana_data:/var/lib/grafana
      - ./monitoring/grafana:/etc/grafana/provisioning
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin123
      - GF_USERS_ALLOW_SIGN_UP=false
    networks:
      - nofx-internal

volumes:
  prometheus_data:
  grafana_data:

networks:
  nofx-internal:
    driver: bridge
    # å†…éƒ¨ç½‘ç»œï¼Œå¢å¼ºå®‰å…¨æ€§
    internal: false
    ipam:
      config:
        - subnet: 172.20.0.0/16
```

#### 4. å¯åŠ¨æœåŠ¡

```bash
# ä½¿ç”¨ç”Ÿäº§é…ç½®å¯åŠ¨
docker-compose -f docker-compose.yml -f docker-compose.prod.yml --env-file .env up -d

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker-compose ps
```

### æ–¹æ¡ˆäºŒï¼šå…¬ç½‘å®Œæ•´éƒ¨ç½²ï¼ˆHTTPS + åŸŸåï¼‰

#### 1. åŸŸåå’ŒSSLå‡†å¤‡

```bash
# 1. å‡†å¤‡åŸŸåï¼ˆå‡è®¾åŸŸåä¸º trading.yourdomain.comï¼‰
DOMAIN="trading.yourdomain.com"

# 2. å®‰è£… Certbot è·å–SSLè¯ä¹¦
sudo apt update
sudo apt install certbot python3-certbot-nginx

# 3. è·å–SSLè¯ä¹¦
sudo certbot --nginx -d $DOMAIN --non-interactive --agree-tos --email admin@yourdomain.com

# 4. è®¾ç½®è‡ªåŠ¨ç»­æœŸ
echo "0 12 * * * /usr/bin/certbot renew --quiet" | sudo crontab -
```

#### 2. å®‰å…¨é…ç½®ï¼ˆå¿…é¡»æ‰§è¡Œï¼‰

```bash
# 1. ç”Ÿæˆå¼ºJWTå¯†é’¥
JWT_SECRET=$(openssl rand -base64 64)
echo "ç”Ÿæˆçš„JWTå¯†é’¥: $JWT_SECRET"

# 2. åˆ›å»ºå®‰å…¨çš„config.json
cat > config.json << EOF
{
  "admin_mode": false,
  "jwt_secret": "$JWT_SECRET",
  "api_server_port": 8080,
  "beta_mode": false,
  "max_daily_loss": 10.0,
  "max_drawdown": 20.0
}
EOF

# 3. åˆ›å»º.envæ–‡ä»¶
cat > .env << EOF
NOFX_BACKEND_PORT=18080
NOFX_FRONTEND_PORT=13000
NOFX_TIMEZONE=Asia/Shanghai
EOF
```

#### 3. Nginxåå‘ä»£ç†é…ç½®

åˆ›å»º `/etc/nginx/sites-available/nofx`:

```nginx
server {
    listen 80;
    server_name $DOMAIN;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name $DOMAIN;

    # SSLé…ç½®
    ssl_certificate /etc/letsencrypt/live/$DOMAIN/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/$DOMAIN/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;

    # å®‰å…¨å¤´
    add_header X-Frame-Options DENY;
    add_header X-Content-Type-Options nosniff;
    add_header X-XSS-Protection "1; mode=block";
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload";
    add_header Referrer-Policy "strict-origin-when-cross-origin";

    # é™åˆ¶è¯·æ±‚å¤§å°
    client_max_body_size 10M;

    # é™åˆ¶è¯·æ±‚é¢‘ç‡
    limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;
    limit_req_zone $binary_remote_addr zone=login:10m rate=5r/m;

    # APIä»£ç†
    location /api/ {
        limit_req zone=api burst=20 nodelay;

        proxy_pass http://127.0.0.1:18080/api/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;

        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;

        # å®‰å…¨é…ç½®
        proxy_hide_header X-Powered-By;
        proxy_hide_header Server;
    }

    # ç™»å½•æ¥å£ç‰¹æ®Šé™åˆ¶
    location /api/auth/login {
        limit_req zone=login burst=3 nodelay;
        proxy_pass http://127.0.0.1:18080/api/auth/login;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # å‰ç«¯
    location / {
        proxy_pass http://127.0.0.1:13000/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }

    # ç¦æ­¢è®¿é—®æ•æ„Ÿè·¯å¾„
    location ~ /\.(?!well-known) {
        deny all;
    }

    location ~ ^/(config|\.env|\.git|backup) {
        deny all;
    }

    # å¥åº·æ£€æŸ¥
    location /health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
    }
}
```

#### 4. é˜²ç«å¢™é…ç½®

```bash
# é…ç½®UFWé˜²ç«å¢™
sudo ufw --force reset
sudo ufw default deny incoming
sudo ufw default allow outgoing

# å…è®¸SSHï¼ˆä¿®æ”¹ç«¯å£ä¸ºä½ çš„SSHç«¯å£ï¼‰
sudo ufw allow 22/tcp

# å…è®¸HTTPå’ŒHTTPS
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# åªå…è®¸æœ¬åœ°è®¿é—®å†…éƒ¨ç«¯å£
sudo ufw allow from 127.0.0.1 to any port 13000
sudo ufw allow from 127.0.0.1 to any port 18080

# å¯ç”¨é˜²ç«å¢™
sudo ufw --force enable

# æ£€æŸ¥çŠ¶æ€
sudo ufw status verbose
```

#### 5. å¯åŠ¨æœåŠ¡

```bash
# 1. ä¿®æ”¹docker-compose.ymlï¼Œç§»é™¤ç«¯å£æ˜ å°„ï¼ˆåªé€šè¿‡Nginxè®¿é—®ï¼‰
sed -i 's/ports:/#ports:/' docker-compose.yml
sed -i 's/- ".*:.*"/# - ".*:.*"/' docker-compose.yml

# 2. å¯åŠ¨DockeræœåŠ¡
docker-compose up -d

# 3. å¯ç”¨Nginxç«™ç‚¹
sudo ln -s /etc/nginx/sites-available/nofx /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx

# 4. éªŒè¯éƒ¨ç½²
curl -I https://$DOMAIN
curl -I https://$DOMAIN/api/health
```

#### 6. å®‰å…¨éªŒè¯

```bash
#!/bin/bash
# å®Œæ•´çš„å®‰å…¨éªŒè¯è„šæœ¬

DOMAIN="trading.yourdomain.com"

echo "=== NOFX å…¬ç½‘éƒ¨ç½²å®‰å…¨éªŒè¯ ==="

# 1. æ£€æŸ¥HTTPS
echo "1. æ£€æŸ¥HTTPSé…ç½®..."
if curl -s -I https://$DOMAIN | grep -q "200 OK"; then
    echo "âœ… HTTPSæ­£å¸¸å·¥ä½œ"
else
    echo "âŒ HTTPSé…ç½®æœ‰é—®é¢˜"
    exit 1
fi

# 2. æ£€æŸ¥SSLè¯ä¹¦
echo "2. æ£€æŸ¥SSLè¯ä¹¦..."
if echo | openssl s_client -connect $DOMAIN:443 -servername $DOMAIN 2>/dev/null | openssl x509 -noout -dates | grep -q "notAfter"; then
    echo "âœ… SSLè¯ä¹¦æœ‰æ•ˆ"
else
    echo "âŒ SSLè¯ä¹¦æœ‰é—®é¢˜"
    exit 1
fi

# 3. æ£€æŸ¥admin_mode
echo "3. æ£€æŸ¥ç®¡ç†å‘˜æ¨¡å¼..."
ADMIN_MODE=$(jq -r '.admin_mode' config.json)
if [ "$ADMIN_MODE" = "false" ]; then
    echo "âœ… admin_mode å·²ç¦ç”¨"
else
    echo "âŒ admin_mode æœªç¦ç”¨ï¼Œå­˜åœ¨ä¸¥é‡å®‰å…¨é£é™©ï¼"
    exit 1
fi

# 4. æ£€æŸ¥JWTå¯†é’¥
echo "4. æ£€æŸ¥JWTå¯†é’¥..."
JWT_SECRET=$(jq -r '.jwt_secret' config.json)
if [ ${#JWT_SECRET} -ge 64 ] && [[ "$JWT_SECRET" != *"your-jwt-secret"* ]]; then
    echo "âœ… JWTå¯†é’¥å¼ºåº¦è¶³å¤Ÿ"
else
    echo "âŒ JWTå¯†é’¥ä¸ç¬¦åˆå®‰å…¨è¦æ±‚"
    exit 1
fi

# 5. æ£€æŸ¥ç«¯å£æš´éœ²
echo "5. æ£€æŸ¥ç«¯å£æš´éœ²..."
if nmap -sT -O $DOMAIN | grep -E "(13000|18080)" | grep -q "closed"; then
    echo "âœ… å†…éƒ¨ç«¯å£æœªå¯¹å¤–æš´éœ²"
else
    echo "âš ï¸ æ£€æµ‹åˆ°ç«¯å£æš´éœ²ï¼Œè¯·æ£€æŸ¥é…ç½®"
fi

# 6. æ£€æŸ¥å®‰å…¨å¤´
echo "6. æ£€æŸ¥å®‰å…¨å¤´..."
SECURITY_HEADERS=$(curl -s -I https://$DOMAIN)
if echo "$SECURITY_HEADERS" | grep -q "Strict-Transport-Security"; then
    echo "âœ… HSTSå®‰å…¨å¤´å·²é…ç½®"
else
    echo "âš ï¸ å»ºè®®é…ç½®HSTSå®‰å…¨å¤´"
fi

# 7. æµ‹è¯•è®¤è¯
echo "7. æµ‹è¯•è®¤è¯..."
HTTP_CODE=$(curl -s -o /dev/null -w "%{http_code}" https://$DOMAIN/api/traders)
if [ "$HTTP_CODE" = "401" ]; then
    echo "âœ… APIè®¤è¯æ­£å¸¸å·¥ä½œ"
else
    echo "âŒ APIè®¤è¯å¯èƒ½æœ‰é—®é¢˜ï¼Œè¿”å›ç : $HTTP_CODE"
fi

echo "=== å®‰å…¨éªŒè¯å®Œæˆ ==="
```

### æ–¹æ¡ˆä¸‰ï¼šCloudflare CDN éƒ¨ç½²ï¼ˆæ¨èï¼‰

ä½¿ç”¨Cloudflare CDNå¯ä»¥éšè—æœåŠ¡å™¨çœŸå®IPï¼Œæå‡å®‰å…¨æ€§å’Œæ€§èƒ½ã€‚æœåŠ¡å™¨é˜²ç«å¢™åªå…è®¸Cloudflare IPæ®µè®¿é—®ã€‚

#### 1. Cloudflare é…ç½®å‡†å¤‡

```bash
# 1. æ³¨å†ŒCloudflareè´¦å·å¹¶æ·»åŠ åŸŸå
# 2. å°†åŸŸåDNSæŒ‡å‘Cloudflare
# 3. å¯ç”¨SSL/TLSåŠ å¯†æ¨¡å¼ï¼ˆæ¨èï¼šFull (strict)ï¼‰

# è®¾ç½®Cloudflare SSL/TLS
# Dashboard > SSL/TLS > Overview > Full (strict)
# Dashboard > SSL/TLS > Edge Certificates > Always Use HTTPS = On
# Dashboard > Network > SSL/TLS Recommender = On
```

#### 2. Cloudflare IPæ®µé˜²ç«å¢™é…ç½®

åˆ›å»º `scripts/cloudflare_firewall.sh`:

```bash
#!/bin/bash
# Cloudflare CDN é˜²ç«å¢™é…ç½®è„šæœ¬

echo "=== é…ç½®Cloudflareé˜²ç«å¢™è§„åˆ™ ==="

# 1. é‡ç½®UFWé˜²ç«å¢™
sudo ufw --force reset
sudo ufw default deny incoming
sudo ufw default allow outgoing

# 2. å…è®¸SSHï¼ˆå»ºè®®ä½¿ç”¨éæ ‡å‡†ç«¯å£ï¼‰
SSH_PORT=2222  # å»ºè®®ä¿®æ”¹SSHç«¯å£
sudo ufw allow $SSH_PORT/tcp comment "SSH access"

# 3. Cloudflare IPv4 IPæ®µ
CLOUDFLARE_IPV4=(
    "103.21.244.0/22"
    "103.22.200.0/22"
    "103.31.4.0/22"
    "104.16.0.0/12"
    "108.162.192.0/18"
    "131.0.72.0/22"
    "141.101.64.0/18"
    "162.158.0.0/15"
    "172.64.0.0/13"
    "173.245.48.0/20"
    "188.114.96.0/20"
    "190.93.240.0/20"
    "197.234.240.0/22"
    "198.41.128.0/17"
)

# 4. å…è®¸Cloudflare IPè®¿é—®HTTP/HTTPSç«¯å£
echo "æ·»åŠ Cloudflare IPæ®µ..."
for ip in "${CLOUDFLARE_IPV4[@]}"; do
    sudo ufw allow from $ip to any port 80 comment "Cloudflare HTTP"
    sudo ufw allow from $ip to any port 443 comment "Cloudflare HTTPS"
done

# 5. å…è®¸æœ¬åœ°è®¿é—®å†…éƒ¨ç«¯å£
sudo ufw allow from 127.0.0.1 to any port 13000 comment "Local frontend"
sudo ufw allow from 127.0.0.1 to any port 18080 comment "Local backend"

# 6. å¯ç”¨é˜²ç«å¢™
sudo ufw --force enable

echo "Cloudflareé˜²ç«å¢™é…ç½®å®Œæˆï¼"
sudo ufw status numbered
```

#### 3. Cloudflare IPè‡ªåŠ¨æ›´æ–°

åˆ›å»º `scripts/cloudflare_ip_update.sh`:

```bash
#!/bin/bash
# Cloudflare IPæ®µè‡ªåŠ¨æ›´æ–°è„šæœ¬

LOG_FILE="/var/log/cloudflare_ip_update.log"
IPTABLES_FILE="/etc/iptables/rules.v4"

log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a $LOG_FILE
}

# è·å–Cloudflareæœ€æ–°IPæ®µ
fetch_cloudflare_ips() {
    log "è·å–Cloudflareæœ€æ–°IPæ®µ..."

    IPV4_URL="https://www.cloudflare.com/ips-v4"

    if curl -s --connect-timeout 10 "$IPV4_URL" > /tmp/cloudflare_ips.txt; then
        if [ -s /tmp/cloudflare_ips.txt ]; then
            log "æˆåŠŸè·å–Cloudflareå®˜æ–¹IPæ®µ"
            return 0
        fi
    fi

    log "è·å–å®˜æ–¹IPæ®µå¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨åˆ—è¡¨"
    # å¤‡ç”¨IPæ®µåˆ—è¡¨
    cat > /tmp/cloudflare_ips.txt << 'EOF'
103.21.244.0/22
103.22.200.0/22
103.31.4.0/22
104.16.0.0/12
108.162.192.0/18
131.0.72.0/22
141.101.64.0/18
162.158.0.0/15
172.64.0.0/13
173.245.48.0/20
188.114.96.0/20
190.93.240.0/20
197.234.240.0/22
198.41.128.0/17
EOF
    return 1
}

# æ›´æ–°é˜²ç«å¢™è§„åˆ™
update_firewall() {
    log "æ›´æ–°é˜²ç«å¢™è§„åˆ™..."

    # å¤‡ä»½å½“å‰è§„åˆ™
    sudo cp $IPTABLES_FILE $IPTABLES_FILE.backup.$(date +%Y%m%d_%H%M%S) 2>/dev/null || true

    # åˆ›å»ºæ–°çš„iptablesè§„åˆ™
    cat > /tmp/new_iptables.rules << 'EOF'
*filter
:INPUT DROP [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [0:0]

# å…è®¸æœ¬åœ°å›ç¯
-A INPUT -i lo -j ACCEPT

# å…è®¸å·²å»ºç«‹çš„è¿æ¥
-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT

# å…è®¸SSH
-A INPUT -p tcp --dport 2222 -j ACCEPT

# å…è®¸Cloudflare IPè®¿é—®HTTP/HTTPS
EOF

    # æ·»åŠ Cloudflare IPè§„åˆ™
    while read -r ip; do
        if [[ -n "$ip" && ! "$ip" =~ ^# ]]; then
            echo "-A INPUT -p tcp -s $ip --dport 80 -j ACCEPT" >> /tmp/new_iptables.rules
            echo "-A INPUT -p tcp -s $ip --dport 443 -j ACCEPT" >> /tmp/new_iptables.rules
        fi
    done < /tmp/cloudflare_ips.txt

    cat >> /tmp/new_iptables.rules << 'EOF'
# å…è®¸æœ¬åœ°è®¿é—®
-A INPUT -s 127.0.0.1 -j ACCEPT

COMMIT
EOF

    # åº”ç”¨æ–°è§„åˆ™
    sudo iptables-restore < /tmp/new_iptables.rules

    if [ $? -eq 0 ]; then
        sudo cp /tmp/new_iptables.rules $IPTABLES_FILE
        log "é˜²ç«å¢™è§„åˆ™æ›´æ–°æˆåŠŸ"
        return 0
    else
        log "é˜²ç«å¢™è§„åˆ™æ›´æ–°å¤±è´¥"
        # å°è¯•æ¢å¤å¤‡ä»½
        if [ -f "$IPTABLES_FILE.backup.$(date +%Y%m%d_%H%M%S)" ]; then
            sudo iptables-restore < "$IPTABLES_FILE.backup.$(date +%Y%m%d_%H%M%S)"
            log "å·²æ¢å¤å¤‡ä»½è§„åˆ™"
        fi
        return 1
    fi
}

# ä¸»å‡½æ•°
main() {
    log "å¼€å§‹Cloudflare IPæ®µæ›´æ–°"

    fetch_cloudflare_ips
    if update_firewall; then
        log "Cloudflare IPæ®µæ›´æ–°å®Œæˆ"

        # é‡å¯ç›¸å…³æœåŠ¡
        sudo systemctl reload nginx 2>/dev/null || true

        # å‘é€é€šçŸ¥ï¼ˆå¯é€‰ï¼‰
        # echo "Cloudflare IPæ®µå·²æ›´æ–°" | mail -s "é˜²ç«å¢™è§„åˆ™æ›´æ–°" admin@yourdomain.com
    else
        log "Cloudflare IPæ®µæ›´æ–°å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ—¥å¿—"
        exit 1
    fi
}

# æ‰§è¡Œæ›´æ–°
main
```

#### 4. è®¾ç½®å®šæ—¶ä»»åŠ¡

```bash
# æ·»åŠ åˆ°crontab
crontab -e

# æ¯å¤©å‡Œæ™¨3ç‚¹æ£€æŸ¥æ›´æ–°Cloudflare IPæ®µ
0 3 * * * /path/to/nofx/scripts/cloudflare_ip_update.sh

# æ¯å‘¨æ—¥å‡Œæ™¨2ç‚¹å¼ºåˆ¶æ›´æ–°
0 2 * * 0 /path/to/nofx/scripts/cloudflare_ip_update.sh --force

# æ¯å°æ—¶æ£€æŸ¥Cloudflareè¿æ¥ç›‘æ§
0 * * * * /path/to/nofx/scripts/cloudflare_monitor.sh
```

#### 5. Nginx Cloudflareé…ç½®

ä¿®æ”¹ `/etc/nginx/sites-available/nofx`:

```nginx
server {
    listen 443 ssl http2;
    server_name your-domain.com;

    # SSLé…ç½®
    ssl_certificate /etc/letsencrypt/live/your-domain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/your-domain.com/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;

    # CloudflareçœŸå®IPé…ç½®
    set_real_ip_from 103.21.244.0/22;
    set_real_ip_from 103.22.200.0/22;
    set_real_ip_from 103.31.4.0/22;
    set_real_ip_from 104.16.0.0/12;
    set_real_ip_from 108.162.192.0/18;
    set_real_ip_from 131.0.72.0/22;
    set_real_ip_from 141.101.64.0/18;
    set_real_ip_from 162.158.0.0/15;
    set_real_ip_from 172.64.0.0/13;
    set_real_ip_from 173.245.48.0/20;
    set_real_ip_from 188.114.96.0/20;
    set_real_ip_from 190.93.240.0/20;
    set_real_ip_from 197.234.240.0/22;
    set_real_ip_from 198.41.128.0/17;
    real_ip_header CF-Connecting-IP;

    # å®‰å…¨å¤´
    add_header X-Frame-Options DENY;
    add_header X-Content-Type-Options nosniff;
    add_header X-XSS-Protection "1; mode=block";
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload";

    # Cloudflareç‰¹å®šå¤´
    add_header Expect-CT "max-age=604800, enforce";

    # å…¶ä»–é…ç½®ä¿æŒä¸å˜...
}
```

#### 6. Cloudflareç›‘æ§å’Œå‘Šè­¦

åˆ›å»º `scripts/cloudflare_monitor.sh`:

```bash
#!/bin/bash
# Cloudflareè¿æ¥ç›‘æ§è„šæœ¬

ALERT_EMAIL="admin@yourdomain.com"
LOG_FILE="/var/log/cloudflare_monitor.log"
DOMAIN="your-domain.com"

log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a $LOG_FILE
}

# æ£€æŸ¥éCloudflare IPè®¿é—®
check_non_cf_access() {
    local access_log="/var/log/nginx/access.log"
    local temp_file="/tmp/non_cf_ips.txt"

    # Cloudflare IPæ®µï¼ˆç®€åŒ–ç‰ˆï¼‰
    grep -v -E "^(103\.|172\.64\.|108\.162\.|141\.101\.|188\.114\.|190\.93\.|197\.234\.|198\.41\.|104\.|162\.158\.|173\.245\.|131\.0\.72)" "$access_log" | \
    awk '{print $1}' | sort | uniq > "$temp_file"

    if [ -s "$temp_file" ]; then
        log "âš ï¸ æ£€æµ‹åˆ°éCloudflare IPè®¿é—®ï¼"
        log "å¯ç–‘IPåˆ—è¡¨ï¼š"
        cat "$temp_file" | while read ip; do
            log "  - $ip"
        done

        # å‘é€å‘Šè­¦
        (
            echo "Subject: ğŸš¨ Cloudflareå®‰å…¨å‘Šè­¦"
            echo "From: Cloudflare Monitor <monitor@your-domain.com>"
            echo "To: $ALERT_EMAIL"
            echo ""
            echo "æ£€æµ‹åˆ°éCloudflare IPè®¿é—®æœåŠ¡å™¨ï¼š"
            echo "åŸŸåï¼š$DOMAIN"
            echo "æ—¶é—´ï¼š$(date)"
            echo ""
            cat "$temp_file"
        ) | sendmail $ALERT_EMAIL

        return 1
    fi

    return 0
}

# æ£€æŸ¥åŸŸåè§£æ
check_domain_resolution() {
    local resolved_ip=$(dig +short $DOMAIN | head -1)

    if [[ -n "$resolved_ip" ]]; then
        log "åŸŸå $DOMAIN è§£æåˆ°: $resolved_ip"

        # æ£€æŸ¥æ˜¯å¦ä¸ºCloudflare IP
        if [[ "$resolved_ip" =~ ^(104\.|172\.64\.|108\.162\.|141\.101\.|188\.114\.|190\.93\.|197\.234\.|198\.41\.|162\.158\.|173\.245\.|103\.|131\.0\.72) ]]; then
            log "âœ… åŸŸåè§£ææ­£å¸¸"
            return 0
        else
            log "âŒ åŸŸåæœªè§£æåˆ°Cloudflare IPï¼Œå¯èƒ½å­˜åœ¨DNSé…ç½®é—®é¢˜"
            return 1
        fi
    else
        log "âŒ æ— æ³•è§£æåŸŸå $DOMAIN"
        return 1
    fi
}

# æ£€æŸ¥HTTPSè¯ä¹¦
check_ssl_cert() {
    local cert_info=$(echo | openssl s_client -connect $DOMAIN:443 -servername $DOMAIN 2>/dev/null | openssl x509 -noout -dates 2>/dev/null)

    if [[ -n "$cert_info" ]]; then
        log "âœ… SSLè¯ä¹¦æ­£å¸¸"
        log "$cert_info"
        return 0
    else
        log "âŒ SSLè¯ä¹¦æ£€æŸ¥å¤±è´¥"
        return 1
    fi
}

# ä¸»ç›‘æ§å‡½æ•°
main() {
    log "å¼€å§‹Cloudflareç›‘æ§æ£€æŸ¥"

    local issues=0

    # æ£€æŸ¥åŸŸåè§£æ
    if ! check_domain_resolution; then
        issues=$((issues + 1))
    fi

    # æ£€æŸ¥éCloudflareè®¿é—®
    if ! check_non_cf_access; then
        issues=$((issues + 1))
    fi

    # æ£€æŸ¥SSLè¯ä¹¦
    if ! check_ssl_cert; then
        issues=$((issues + 1))
    fi

    if [ $issues -eq 0 ]; then
        log "âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡"
    else
        log "âŒ å‘ç° $issues ä¸ªé—®é¢˜"
    fi
}

# æ‰§è¡Œç›‘æ§
main
```

#### 7. å®Œæ•´éƒ¨ç½²è„šæœ¬

åˆ›å»º `scripts/deploy_with_cloudflare.sh`:

```bash
#!/bin/bash
# NOFX + Cloudflare å®Œæ•´éƒ¨ç½²è„šæœ¬

DOMAIN="your-domain.com"
ADMIN_EMAIL="admin@your-domain.com"

echo "=== NOFX + Cloudflare å®Œæ•´éƒ¨ç½² ==="

# 1. ç¯å¢ƒå‡†å¤‡
echo "1. ç¯å¢ƒå‡†å¤‡..."
apt update && apt install -y certbot python3-certbot-nginx ufw fail2ban

# 2. å®‰å…¨é…ç½®
echo "2. å®‰å…¨é…ç½®..."
# ç”Ÿæˆå¼ºJWTå¯†é’¥
JWT_SECRET=$(openssl rand -base64 64)

# åˆ›å»ºé…ç½®æ–‡ä»¶
cat > config.json << EOF
{
  "admin_mode": false,
  "jwt_secret": "$JWT_SECRET",
  "api_server_port": 8080,
  "beta_mode": false,
  "max_daily_loss": 10.0,
  "max_drawdown": 20.0
}
EOF

# 3. SSLè¯ä¹¦
echo "3. è·å–SSLè¯ä¹¦..."
sudo certbot --nginx -d $DOMAIN --non-interactive --agree-tos --email $ADMIN_EMAIL

# 4. é˜²ç«å¢™é…ç½®
echo "4. é…ç½®é˜²ç«å¢™..."
./scripts/cloudflare_firewall.sh

# 5. å¯åŠ¨æœåŠ¡
echo "5. å¯åŠ¨æœåŠ¡..."
# ä¿®æ”¹docker-compose.ymlï¼Œç§»é™¤å¤–éƒ¨ç«¯å£æ˜ å°„
sed -i 's/ports:/#ports:/' docker-compose.yml
sed -i 's/- ".*:.*"/# - ".*:.*"/' docker-compose.yml

# å¯åŠ¨DockeræœåŠ¡
docker-compose up -d

# å¯ç”¨Nginxç«™ç‚¹
sudo ln -s /etc/nginx/sites-available/nofx /etc/nginx/sites-enabled/
sudo nginx -t && sudo systemctl reload nginx

# 6. è®¾ç½®å®šæ—¶ä»»åŠ¡
echo "6. è®¾ç½®å®šæ—¶ä»»åŠ¡..."
(crontab -l 2>/dev/null; echo "0 3 * * * /path/to/nofx/scripts/cloudflare_ip_update.sh") | crontab -
(crontab -l 2>/dev/null; echo "0 * * * * /path/to/nofx/scripts/cloudflare_monitor.sh") | crontab -

# 7. éªŒè¯éƒ¨ç½²
echo "7. éªŒè¯éƒ¨ç½²..."
./scripts/verify_cloudflare_setup.sh

echo "=== éƒ¨ç½²å®Œæˆï¼==="
echo "è®¿é—®åœ°å€: https://$DOMAIN"
echo "è¯·ç¡®ä¿ï¼š"
echo "1. Cloudflare DNSå·²æ­£ç¡®é…ç½®"
echo "2. SSL/TLSæ¨¡å¼è®¾ç½®ä¸º Full (strict)"
echo "3. é˜²ç«å¢™è§„åˆ™å·²ç”Ÿæ•ˆ"
echo "4. ç›‘æ§è„šæœ¬æ­£å¸¸è¿è¡Œ"
```

#### 8. é…ç½®éªŒè¯è„šæœ¬

åˆ›å»º `scripts/verify_cloudflare_setup.sh`:

```bash
#!/bin/bash
# Cloudflareé…ç½®éªŒè¯è„šæœ¬

DOMAIN="your-domain.com"

echo "=== Cloudflareé…ç½®éªŒè¯ ==="

# 1. æ£€æŸ¥åŸŸåè§£æ
echo "1. æ£€æŸ¥åŸŸåDNSè§£æ..."
RESOLVED_IP=$(dig +short $DOMAIN | head -1)
echo "åŸŸå $DOMAIN è§£æåˆ°: $RESOLVED_IP"

# æ£€æŸ¥æ˜¯å¦ä¸ºCloudflare IP
if [[ "$RESOLVED_IP" =~ ^(104\.|172\.64\.|108\.162\.|141\.101\.|188\.114\.|190\.93\.|197\.234\.|198\.41\.|162\.158\.|173\.245\.|103\.|131\.0\.72) ]]; then
    echo "âœ… åŸŸåæ­£ç¡®è§£æåˆ°Cloudflare"
else
    echo "âŒ åŸŸåæœªè§£æåˆ°Cloudflare IP"
    exit 1
fi

# 2. æ£€æŸ¥HTTPS
echo "2. æ£€æŸ¥HTTPSè¿æ¥..."
HTTP_CODE=$(curl -s -o /dev/null -w "%{http_code}" https://$DOMAIN)
if [ "$HTTP_CODE" = "200" ]; then
    echo "âœ… HTTPSè¿æ¥æ­£å¸¸"
else
    echo "âŒ HTTPSè¿æ¥å¤±è´¥ (HTTP $HTTP_CODE)"
    exit 1
fi

# 3. æ£€æŸ¥çœŸå®IP
echo "3. æ£€æŸ¥çœŸå®IPæ³„éœ²..."
DETECTED_IP=$(curl -s --header "CF-IPCountry: US" https://1.1.1.1/cdn-cgi/trace | grep "ip=" | cut -d= -f2)
if [[ "$DETECTED_IP" =~ ^(104\.|172\.64\.|108\.162\.|141\.101\.|188\.114\.|190\.93\.|197\.234\.|198\.41\.|162\.158\.|173\.245\.|103\.|131\.0\.72) ]]; then
    echo "âœ… æœªæ£€æµ‹åˆ°çœŸå®IPæ³„éœ²"
else
    echo "âš ï¸ å¯èƒ½å­˜åœ¨çœŸå®IPæ³„éœ²: $DETECTED_IP"
fi

# 4. æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
echo "4. æ£€æŸ¥é˜²ç«å¢™è§„åˆ™..."
if sudo ufw status | grep -q "Cloudflare"; then
    echo "âœ… é˜²ç«å¢™åŒ…å«Cloudflareè§„åˆ™"
else
    echo "âŒ é˜²ç«å¢™æœªé…ç½®Cloudflareè§„åˆ™"
    exit 1
fi

# 5. æ£€æŸ¥APIè®¤è¯
echo "5. æ£€æŸ¥APIè®¤è¯..."
API_CODE=$(curl -s -o /dev/null -w "%{http_code}" https://$DOMAIN/api/traders)
if [ "$API_CODE" = "401" ]; then
    echo "âœ… APIè®¤è¯æ­£å¸¸å·¥ä½œ"
else
    echo "âŒ APIè®¤è¯å¯èƒ½æœ‰é—®é¢˜ (HTTP $API_CODE)"
    exit 1
fi

# 6. æ£€æŸ¥Cloudflare Headers
echo "6. æ£€æŸ¥Cloudflare Headers..."
CF_RAY=$(curl -s -I https://$DOMAIN | grep -i "cf-ray")
if [ -n "$CF_RAY" ]; then
    echo "âœ… è¯·æ±‚é€šè¿‡Cloudflare (CF-Ray: $CF_RAY)"
else
    echo "âŒ è¯·æ±‚æœªé€šè¿‡Cloudflare"
    exit 1
fi

echo "=== éªŒè¯å®Œæˆï¼Œæ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼==="
```

### æ–¹æ¡ˆå››ï¼šPM2 éƒ¨ç½²

```bash
# æ„å»ºåº”ç”¨
go build -o nofx
cd web && npm install && npm run build

# ä½¿ç”¨ PM2 å¯åŠ¨
./pm2.sh start

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
pm2 save
```

## ğŸŒ å…¬ç½‘éƒ¨ç½²å®‰å…¨é…ç½®

### âš ï¸ é‡è¦å®‰å…¨è­¦å‘Š

**å…¬ç½‘éƒ¨ç½²å¿…é¡»å®Œæˆä»¥ä¸‹ä¸‰ä¸ªå®‰å…¨é…ç½®ï¼Œå¦åˆ™ç³»ç»Ÿå°†é¢ä¸´ä¸¥é‡å®‰å…¨é£é™©ï¼š**

#### 1. ç¦ç”¨ç®¡ç†å‘˜æ¨¡å¼
```bash
# ä¿®æ”¹ config.json
nano config.json
```

```json
{
  "admin_mode": false,
  "jwt_secret": "æ–°ç”Ÿæˆçš„å¼ºå¯†é’¥"
}
```

**é£é™©è¯´æ˜**ï¼š
- `admin_mode: true` æ—¶ï¼Œç³»ç»Ÿè·³è¿‡èº«ä»½éªŒè¯ï¼Œä»»ä½•äººéƒ½å¯ä»¥ç›´æ¥è®¿é—®
- è‡ªåŠ¨åˆ›å»ºadminç”¨æˆ·ï¼Œæ— éœ€å¯†ç å³å¯ç™»å½•
- å…¬ç½‘éƒ¨ç½²æ—¶ç­‰äº**å¼€æ”¾æ‰€æœ‰åŠŸèƒ½ç»™åŒ¿åç”¨æˆ·**

#### 2. ç”Ÿæˆå¼ºJWTå¯†é’¥
```bash
# ç”Ÿæˆ64å­—èŠ‚base64ç¼–ç çš„å¼ºå¯†é’¥
JWT_SECRET=$(openssl rand -base64 64)
echo "ç”Ÿæˆçš„JWTå¯†é’¥: $JWT_SECRET"

# æ›´æ–°é…ç½®æ–‡ä»¶
sed -i "s/\"jwt_secret\": .*/\"jwt_secret\": \"$JWT_SECRET\"/" config.json
```

**é£é™©è¯´æ˜**ï¼š
- é»˜è®¤JWTå¯†é’¥ä¸ºå¼±å¯†é’¥ï¼Œå®¹æ˜“è¢«æš´åŠ›ç ´è§£
- ä¸€æ—¦å¯†é’¥æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥ä¼ªé€ ä»»æ„ç”¨æˆ·token
- å¯¼è‡´å®Œå…¨çš„èº«ä»½è®¤è¯ç»•è¿‡

#### 3. JWTå¯†é’¥å®‰å…¨é…ç½®

**âš ï¸ JWTå¯†é’¥æ˜¯ç³»ç»Ÿå®‰å…¨çš„æ ¸å¿ƒï¼Œå¿…é¡»ä½¿ç”¨å¼ºå¯†é’¥ï¼**

##### å¯†é’¥ç”Ÿæˆæ–¹æ³•

**æ–¹æ³•ä¸€ï¼šOpenSSLï¼ˆæ¨èï¼‰**
```bash
# ç”Ÿæˆ64å­—èŠ‚Base64ç¼–ç çš„å¼ºå¯†é’¥ï¼ˆæ¨èï¼‰
JWT_SECRET=$(openssl rand -base64 64)
echo "ç”Ÿæˆçš„JWTå¯†é’¥: $JWT_SECRET"

# ç”ŸæˆBase64URLç¼–ç å¯†é’¥ï¼ˆJWTæ ‡å‡†ï¼‰
JWT_SECRET=$(openssl rand -base64 64 | tr '/+' '_-' | tr -d '=')

# ç”Ÿæˆ128å­—èŠ‚è¶…å¼ºå¯†é’¥
JWT_SECRET=$(openssl rand -base64 128)
```

**æ–¹æ³•äºŒï¼šä½¿ç”¨JWTç®¡ç†è„šæœ¬**
```bash
# åˆ›å»ºJWTå¯†é’¥ç®¡ç†è„šæœ¬
./scripts/jwt_secret_manager.sh generate 64 base64url

# è½®æ¢å¯†é’¥
./scripts/jwt_secret_manager.sh rotate 64 base64

# æ£€æŸ¥å½“å‰å¯†é’¥çŠ¶æ€
./scripts/jwt_secret_manager.sh check
```

##### å¯†é’¥å®‰å…¨è¦æ±‚

| é¡¹ç›® | è¦æ±‚ | è¯´æ˜ |
|------|------|------|
| é•¿åº¦ | â‰¥64å­—èŠ‚ | æ¨èä½¿ç”¨64-128å­—èŠ‚ |
| ç†µå€¼ | å¯†ç å­¦å®‰å…¨ | ä½¿ç”¨OpenSSLæˆ–ç³»ç»Ÿéšæœºæ•°ç”Ÿæˆå™¨ |
| ç¼–ç  | Base64/URL | æ”¯æŒBase64æˆ–Base64URLç¼–ç  |
| å­˜å‚¨ | å®‰å…¨å­˜å‚¨ | é¿å…ç¡¬ç¼–ç ï¼Œä½¿ç”¨é…ç½®æ–‡ä»¶æˆ–ç¯å¢ƒå˜é‡ |
| è½®æ¢ | å®šæœŸæ›´æ¢ | å»ºè®®æ¯90å¤©è½®æ¢ä¸€æ¬¡ |

##### å®Œæ•´çš„JWTç®¡ç†è„šæœ¬

åˆ›å»º `scripts/jwt_secret_manager.sh`:

```bash
#!/bin/bash
# JWTå¯†é’¥ç®¡ç†è„šæœ¬

CONFIG_FILE="config.json"
BACKUP_DIR="./backups/jwt_secrets"
LOG_FILE="./logs/jwt_management.log"

# åˆ›å»ºå¿…è¦ç›®å½•
mkdir -p "$BACKUP_DIR" "$(dirname "$LOG_FILE")"

log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

# ç”ŸæˆJWTå¯†é’¥
generate_jwt_secret() {
    local length=${1:-64}
    local encoding=${2:-base64}

    case $encoding in
        "base64")
            openssl rand -base64 $length
            ;;
        "base64url")
            openssl rand -base64 $length | tr '/+' '_-' | tr -d '='
            ;;
        "hex")
            openssl rand -hex $((length / 2))
            ;;
        *)
            echo "ä¸æ”¯æŒçš„ç¼–ç æ–¹å¼: $encoding"
            return 1
            ;;
    esac
}

# éªŒè¯å¯†é’¥å¼ºåº¦
validate_secret_strength() {
    local secret="$1"
    local min_length=32

    if [ ${#secret} -lt $min_length ]; then
        log "âŒ å¯†é’¥é•¿åº¦ä¸è¶³ï¼Œè‡³å°‘éœ€è¦ $min_length å­—ç¬¦"
        return 1
    fi

    # æ£€æŸ¥å¸¸è§å¼±å¯†é’¥æ¨¡å¼
    local weak_patterns=("password" "secret" "key" "123" "test" "admin" "default")
    for pattern in "${weak_patterns[@]}"; do
        if [[ "$secret" =~ $pattern ]]; then
            log "âŒ å¯†é’¥åŒ…å«å¸¸è§å¼±å¯†ç æ¨¡å¼"
            return 1
        fi
    done

    log "âœ… å¯†é’¥å¼ºåº¦éªŒè¯é€šè¿‡"
    return 0
}

# æ›´æ–°é…ç½®æ–‡ä»¶ä¸­çš„JWTå¯†é’¥
update_jwt_secret() {
    local new_secret="$1"

    # éªŒè¯å¯†é’¥å¼ºåº¦
    if ! validate_secret_strength "$new_secret"; then
        return 1
    fi

    # å¤‡ä»½å½“å‰é…ç½®
    local timestamp=$(date +%Y%m%d_%H%M%S)
    cp "$CONFIG_FILE" "$BACKUP_DIR/config_backup_$timestamp.json" 2>/dev/null || true

    # æ›´æ–°å¯†é’¥
    if command -v jq &> /dev/null; then
        jq --arg secret "$new_secret" '.jwt_secret = $secret' "$CONFIG_FILE" > "$CONFIG_FILE.tmp"
        mv "$CONFIG_FILE.tmp" "$CONFIG_FILE"
    else
        sed -i "s/\"jwt_secret\": \".*\"/\"jwt_secret\": \"$new_secret\"/" "$CONFIG_FILE"
    fi

    if [ $? -eq 0 ]; then
        log "âœ… JWTå¯†é’¥å·²æˆåŠŸæ›´æ–°"
        log "æ–°å¯†é’¥é•¿åº¦: ${#new_secret} å­—ç¬¦"
        log "è¯·é‡å¯åº”ç”¨ä»¥ä½¿æ–°å¯†é’¥ç”Ÿæ•ˆ"
        return 0
    else
        log "âŒ JWTå¯†é’¥æ›´æ–°å¤±è´¥"
        return 1
    fi
}

# å¯†é’¥è½®æ¢
rotate_secret() {
    local length=${1:-64}
    local encoding=${2:-base64}

    log "å¼€å§‹å¯†é’¥è½®æ¢..."
    local new_secret
    new_secret=$(generate_jwt_secret $length $encoding)

    if [ $? -eq 0 ] && [ -n "$new_secret" ]; then
        if update_jwt_secret "$new_secret"; then
            log "âœ… å¯†é’¥è½®æ¢å®Œæˆ"
            echo "æ–°å¯†é’¥: $new_secret"
            echo "è¯·é‡å¯åº”ç”¨ä»¥ä½¿æ–°å¯†é’¥ç”Ÿæ•ˆ"
            return 0
        fi
    fi

    log "âŒ å¯†é’¥è½®æ¢å¤±è´¥"
    return 1
}

# æ£€æŸ¥å¯†é’¥çŠ¶æ€
check_secret_status() {
    local current_secret
    if command -v jq &> /dev/null; then
        current_secret=$(jq -r '.jwt_secret' "$CONFIG_FILE" 2>/dev/null)
    else
        current_secret=$(grep -o '"jwt_secret": "[^"]*"' "$CONFIG_FILE" | cut -d'"' -f4)
    fi

    if [ -z "$current_secret" ]; then
        log "âŒ æ— æ³•è·å–å½“å‰JWTå¯†é’¥"
        return 1
    fi

    echo "å½“å‰JWTå¯†é’¥çŠ¶æ€:"
    echo "é•¿åº¦: ${#current_secret} å­—ç¬¦"
    echo "å¼ºåº¦: ${#current_secret} å­—èŠ‚"

    if validate_secret_strength "$current_secret"; then
        echo "çŠ¶æ€: âœ… å¼ºåº¦è¶³å¤Ÿ"
    else
        echo "çŠ¶æ€: âŒ å¼ºåº¦ä¸è¶³ï¼Œå»ºè®®æ›´æ¢"
    fi

    # æ£€æŸ¥æ˜¯å¦ä¸ºé»˜è®¤å¯†é’¥
    if [[ "$current_secret" =~ (default|your-jwt-secret|example|test) ]]; then
        echo "âš ï¸  æ£€æµ‹åˆ°é»˜è®¤æˆ–æµ‹è¯•å¯†é’¥ï¼Œå­˜åœ¨å®‰å…¨é£é™©ï¼"
        return 1
    fi
}

# ä¸»å‡½æ•°
case "${1:-help}" in
    "generate")
        generate_jwt_secret "${2:-64}" "${3:-base64}"
        ;;
    "update")
        update_jwt_secret "$2"
        ;;
    "rotate")
        rotate_secret "${2:-64}" "${3:-base64}"
        ;;
    "check")
        check_secret_status
        ;;
    "help"|"--help"|"-h")
        echo "JWTå¯†é’¥ç®¡ç†è„šæœ¬"
        echo "ç”¨æ³•: $0 {generate|update|rotate|check} [å‚æ•°]"
        echo "  generate [é•¿åº¦] [ç¼–ç ]  - ç”Ÿæˆæ–°å¯†é’¥"
        echo "  update <å¯†é’¥>          - æ›´æ–°å¯†é’¥"
        echo "  rotate [é•¿åº¦] [ç¼–ç ]   - è½®æ¢å¯†é’¥"
        echo "  check                 - æ£€æŸ¥å¯†é’¥çŠ¶æ€"
        ;;
    *)
        echo "é”™è¯¯: æœªçŸ¥å‘½ä»¤ '$1'"
        echo "ä½¿ç”¨ '$0 help' æŸ¥çœ‹å¸®åŠ©"
        exit 1
        ;;
esac
```

##### å¯†é’¥è½®æ¢ç­–ç•¥

```bash
# è®¾ç½®å®šæ—¶å¯†é’¥è½®æ¢ï¼ˆæ¯90å¤©ï¼‰
crontab -e

# æ¯å­£åº¦ç¬¬ä¸€å¤©å‡Œæ™¨2ç‚¹è½®æ¢å¯†é’¥
0 2 1 */3 * /path/to/nofx/scripts/jwt_secret_manager.sh rotate && systemctl restart nofx

# æ¯å‘¨æ£€æŸ¥å¯†é’¥çŠ¶æ€
0 8 * * 1 /path/to/nofx/scripts/jwt_secret_manager.sh check
```

##### å¯†é’¥å­˜å‚¨æœ€ä½³å®è·µ

```bash
# âœ… æ¨èæ–¹å¼1ï¼šé…ç½®æ–‡ä»¶
{
  "jwt_secret": "your-generated-secret-here",
  "admin_mode": false
}

# âœ… æ¨èæ–¹å¼2ï¼šç¯å¢ƒå˜é‡
export JWT_SECRET="$(openssl rand -base64 64)"
echo "JWT_SECRET=$JWT_SECRET" >> .env

# âŒ é”™è¯¯æ–¹å¼ï¼šç¡¬ç¼–ç 
const JWT_SECRET = "my-secret-key";
```

##### å¿«é€Ÿéƒ¨ç½²å‘½ä»¤

```bash
# ä¸€é”®ç”Ÿæˆå’Œé…ç½®JWTå¯†é’¥
JWT_SECRET=$(openssl rand -base64 64)
jq --arg secret "$JWT_SECRET" '.jwt_secret = $secret' config.json > config.json.tmp && mv config.json.tmp config.json

# æˆ–ä½¿ç”¨ç®¡ç†è„šæœ¬
./scripts/jwt_secret_manager.sh rotate 64 base64

# éªŒè¯é…ç½®
./scripts/jwt_secret_manager.sh check
```

#### 4. é…ç½®HTTPSåŸŸå
å‚è€ƒ [ç«¯å£å®‰å…¨ç­–ç•¥](#ç«¯å£å®‰å…¨ç­–ç•¥) ä¸­çš„åå‘ä»£ç†é…ç½®ï¼Œå¼ºåˆ¶ä½¿ç”¨HTTPSã€‚

### å…¬ç½‘éƒ¨ç½²å®‰å…¨æ£€æŸ¥æ¸…å•

```bash
#!/bin/bash
# å…¬ç½‘å®‰å…¨æ£€æŸ¥è„šæœ¬

echo "=== NOFX å…¬ç½‘å®‰å…¨æ£€æŸ¥ ==="

# 1. æ£€æŸ¥admin_mode
ADMIN_MODE=$(jq -r '.admin_mode' config.json)
if [ "$ADMIN_MODE" = "false" ]; then
    echo "âœ… admin_mode å·²æ­£ç¡®è®¾ç½®ä¸º false"
else
    echo "âŒ admin_mode ä¸º trueï¼Œå­˜åœ¨ä¸¥é‡å®‰å…¨é£é™©ï¼"
    echo "è¯·ä¿®æ”¹ config.json: \"admin_mode\": false"
    exit 1
fi

# 2. æ£€æŸ¥JWTå¯†é’¥å¼ºåº¦
JWT_SECRET=$(jq -r '.jwt_secret' config.json)
if [ ${#JWT_SECRET} -ge 64 ]; then
    echo "âœ… JWTå¯†é’¥é•¿åº¦è¶³å¤Ÿ"
else
    echo "âŒ JWTå¯†é’¥å¤ªçŸ­ï¼Œå­˜åœ¨å®‰å…¨é£é™©ï¼"
    echo "è¯·ä½¿ç”¨ openssl rand -base64 64 ç”Ÿæˆæ–°å¯†é’¥"
    exit 1
fi

# 3. æ£€æŸ¥æ˜¯å¦ä½¿ç”¨é»˜è®¤å¯†é’¥
if [[ "$JWT_SECRET" == *"your-jwt-secret"* ]]; then
    echo "âŒ ä½¿ç”¨äº†é»˜è®¤JWTå¯†é’¥ï¼Œå­˜åœ¨ä¸¥é‡å®‰å…¨é£é™©ï¼"
    exit 1
else
    echo "âœ… æœªä½¿ç”¨é»˜è®¤JWTå¯†é’¥"
fi

# 4. æ£€æŸ¥ç«¯å£ç»‘å®š
if docker-compose.yml | grep -q "127.0.0.1:"; then
    echo "âœ… ç«¯å£å·²ç»‘å®šåˆ°æœ¬åœ°å›ç¯åœ°å€"
else
    echo "âš ï¸ å»ºè®®å°†ç«¯å£ç»‘å®šåˆ° 127.0.0.1 ä»¥å¢å¼ºå®‰å…¨æ€§"
fi

# 5. æ£€æŸ¥é˜²ç«å¢™
if command -v ufw &> /dev/null; then
    if ufw status | grep -q "Status: active"; then
        echo "âœ… é˜²ç«å¢™å·²å¯ç”¨"
    else
        echo "âš ï¸ é˜²ç«å¢™æœªå¯ç”¨ï¼Œå»ºè®®å¯ç”¨"
    fi
fi

echo "=== å®‰å…¨æ£€æŸ¥å®Œæˆ ==="
```

## ğŸ”’ ç«¯å£å®‰å…¨ç­–ç•¥

### é»˜è®¤ç«¯å£é…ç½®

| æœåŠ¡ | é»˜è®¤ç«¯å£ | å»ºè®®ç«¯å£ | ç”¨é€” |
|------|----------|----------|------|
| å‰ç«¯ Web ç•Œé¢ | 3000 | 13000 | ç”¨æˆ·è®¿é—®ç•Œé¢ |
| åç«¯ API | 8080 | 18080 | API æ¥å£ |
| ç›‘æ§é¢æ¿ | - | 3001 | Grafanaï¼ˆå¯é€‰ï¼‰ |
| æŒ‡æ ‡æ”¶é›† | - | 9090 | Prometheusï¼ˆå¯é€‰ï¼‰ |

### å®‰å…¨é…ç½®æ–¹æ¡ˆ

#### æ–¹æ¡ˆä¸€ï¼šåŸºç¡€å®‰å…¨é…ç½®ï¼ˆæ¨èï¼‰

```bash
# 1. ä¿®æ”¹ç«¯å£ä¸ºéæ ‡å‡†ç«¯å£
cat > .env << EOF
NOFX_BACKEND_PORT=18080
NOFX_FRONTEND_PORT=13000
NOFX_TIMEZONE=Asia/Shanghai
EOF

# 2. ä¿®æ”¹ docker-compose.ymlï¼Œåªç»‘å®šæœ¬åœ°å›ç¯åœ°å€
sed -i 's/"${NOFX_BACKEND_PORT:-8080}:8080"/"127.0.0.1:${NOFX_BACKEND_PORT:-18080}:8080"/' docker-compose.yml
sed -i 's/"${NOFX_FRONTEND_PORT:-3000}:80"/"127.0.0.1:${NOFX_FRONTEND_PORT:-13000}:80"/' docker-compose.yml

# 3. é‡å¯æœåŠ¡
docker-compose down && docker-compose up -d
```

#### æ–¹æ¡ˆäºŒï¼šé˜²ç«å¢™é…ç½®

##### Linux (iptables)
```bash
# æ¸…ç©ºç°æœ‰è§„åˆ™
sudo iptables -F
sudo iptables -X
sudo iptables -t nat -F
sudo iptables -t nat -X

# è®¾ç½®é»˜è®¤ç­–ç•¥
sudo iptables -P INPUT DROP
sudo iptables -P FORWARD DROP
sudo iptables -P OUTPUT ACCEPT

# å…è®¸æœ¬åœ°å›ç¯
sudo iptables -A INPUT -i lo -j ACCEPT
sudo iptables -A OUTPUT -o lo -j ACCEPT

# å…è®¸å·²å»ºç«‹çš„è¿æ¥
sudo iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT

# åªå…è®¸æœ¬åœ°è®¿é—®æŒ‡å®šç«¯å£
sudo iptables -A INPUT -p tcp --dport 13000 -s 127.0.0.1 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 18080 -s 127.0.0.1 -j ACCEPT

# å¯é€‰ï¼šå…è®¸ç‰¹å®šIPè®¿é—®
# sudo iptables -A INPUT -p tcp --dport 13000 -s YOUR_TRUSTED_IP -j ACCEPT
# sudo iptables -A INPUT -p tcp --dport 18080 -s YOUR_TRUSTED_IP -j ACCEPT

# ä¿å­˜è§„åˆ™
sudo iptables-save > /etc/iptables/rules.v4
```

##### Linux (ufw)
```bash
# é‡ç½®é˜²ç«å¢™
sudo ufw --force reset

# é»˜è®¤ç­–ç•¥
sudo ufw default deny incoming
sudo ufw default allow outgoing

# åªå…è®¸æœ¬åœ°è®¿é—®
sudo ufw allow from 127.0.0.1 to any port 13000
sudo ufw allow from 127.0.0.1 to any port 18080

# å¯é€‰ï¼šå…è®¸ç‰¹å®šIP
# sudo ufw allow from YOUR_TRUSTED_IP to any port 13000
# sudo ufw allow from YOUR_TRUSTED_IP to any port 18080

# å¯ç”¨é˜²ç«å¢™
sudo ufw --force enable
```

##### macOS
```bash
# åˆ›å»º pf è§„åˆ™æ–‡ä»¶
cat > /etc/pf.anchors/nofx << EOF
# NOFX é˜²ç«å¢™è§„åˆ™
block in on any proto tcp from any to any port {13000,18080}
pass in on any proto tcp from 127.0.0.1 to any port {13000,18080}
# å¯é€‰ï¼šå…è®¸ç‰¹å®šIP
# pass in on any proto tcp from YOUR_TRUSTED_IP to any port {13000,18080}
EOF

# åŠ è½½è§„åˆ™
echo "anchor \"nofx\"" | sudo tee /etc/pf.conf
echo "load anchor \"nofx\" from \"/etc/pf.anchors/nofx\"" | sudo tee -a /etc/pf.conf
sudo pfctl -f /etc/pf.conf
sudo pfctl -e
```

#### æ–¹æ¡ˆä¸‰ï¼šåå‘ä»£ç†é…ç½®

åˆ›å»º `nginx/nginx.proxy.conf`:

```nginx
upstream nofx_backend {
    server 127.0.0.1:18080;
}

upstream nofx_frontend {
    server 127.0.0.1:13000;
}

# HTTP é‡å®šå‘åˆ° HTTPS
server {
    listen 80;
    server_name your-domain.com;
    return 301 https://$server_name$request_uri;
}

# HTTPS ä¸»ç«™ç‚¹
server {
    listen 443 ssl http2;
    server_name your-domain.com;

    # SSL é…ç½®
    ssl_certificate /path/to/ssl/cert.pem;
    ssl_certificate_key /path/to/ssl/key.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512;
    ssl_prefer_server_ciphers off;

    # å®‰å…¨å¤´
    add_header X-Frame-Options DENY;
    add_header X-Content-Type-Options nosniff;
    add_header X-XSS-Protection "1; mode=block";
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains";

    # åŸºç¡€è®¤è¯ï¼ˆå¯é€‰ï¼‰
    auth_basic "Restricted Area";
    auth_basic_user_file /etc/nginx/.htpasswd;

    # é™åˆ¶è¯·æ±‚é¢‘ç‡
    limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;
    limit_req_zone $binary_remote_addr zone=general:10m rate=30r/s;

    # API ä»£ç†
    location /api/ {
        limit_req zone=api burst=20 nodelay;
        proxy_pass http://nofx_backend/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # å‰ç«¯
    location / {
        limit_req zone=general burst=50 nodelay;
        proxy_pass http://nofx_frontend/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # ç¦æ­¢è®¿é—®æ•æ„Ÿè·¯å¾„
    location ~ /\.(?!well-known) {
        deny all;
    }
}
```

### å®‰å…¨æ£€æŸ¥æ¸…å•

```bash
# 1. æ£€æŸ¥ç«¯å£ç›‘å¬æƒ…å†µ
netstat -tlnp | grep -E ":(13000|18080)"

# 2. æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
sudo iptables -L -n | grep -E ":(13000|18080)"
# æˆ–
sudo ufw status numbered

# 3. æµ‹è¯•æœ¬åœ°è®¿é—®
curl -I http://127.0.0.1:13000
curl -I http://127.0.0.1:18080/api/health

# 4. æµ‹è¯•å¤–éƒ¨è®¿é—®ï¼ˆåº”è¯¥è¢«æ‹’ç»ï¼‰
timeout 5 curl -I http://YOUR_EXTERNAL_IP:13000
timeout 5 curl -I http://YOUR_EXTERNAL_IP:18080

# 5. ç«¯å£æ‰«ææ£€æµ‹
nmap -sT -O localhost
```

## ğŸ“Š ç³»ç»Ÿç›‘æ§

### åŸºç¡€ç›‘æ§è„šæœ¬

åˆ›å»º `scripts/monitor.sh`:

```bash
#!/bin/bash

# NOFX ç³»ç»Ÿç›‘æ§è„šæœ¬
LOG_FILE="/var/log/nofx-monitor.log"
ALERT_EMAIL="your-email@example.com"

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
check_service() {
    local service_name=$1
    local container_name=$2
    local port=$3

    if docker ps | grep -q $container_name; then
        echo "$(date): âœ“ $service_name è¿è¡Œæ­£å¸¸" >> $LOG_FILE
        return 0
    else
        echo "$(date): âœ— $service_name æœªè¿è¡Œ" >> $LOG_FILE
        # å‘é€å‘Šè­¦
        echo "$service_name æœåŠ¡å¼‚å¸¸ï¼Œè¯·ç«‹å³æ£€æŸ¥" | mail -s "NOFX å‘Šè­¦" $ALERT_EMAIL
        return 1
    fi
}

# æ£€æŸ¥ç«¯å£è¿é€šæ€§
check_port() {
    local port=$1
    local service=$2

    if nc -z localhost $port; then
        echo "$(date): âœ“ $service ç«¯å£ $port å¯è®¿é—®" >> $LOG_FILE
        return 0
    else
        echo "$(date): âœ— $service ç«¯å£ $port ä¸å¯è®¿é—®" >> $LOG_FILE
        return 1
    fi
}

# æ£€æŸ¥ç£ç›˜ç©ºé—´
check_disk() {
    local usage=$(df / | awk 'NR==2 {print $5}' | sed 's/%//')
    if [ $usage -gt 80 ]; then
        echo "$(date): âš ï¸ ç£ç›˜ä½¿ç”¨ç‡è¿‡é«˜: ${usage}%" >> $LOG_FILE
        echo "ç£ç›˜ä½¿ç”¨ç‡è¿‡é«˜: ${usage}%" | mail -s "NOFX ç£ç›˜å‘Šè­¦" $ALERT_EMAIL
    else
        echo "$(date): âœ“ ç£ç›˜ä½¿ç”¨ç‡æ­£å¸¸: ${usage}%" >> $LOG_FILE
    fi
}

# æ£€æŸ¥å†…å­˜ä½¿ç”¨
check_memory() {
    local usage=$(free | awk 'NR==2{printf "%.0f", $3*100/$2}')
    if [ $usage -gt 85 ]; then
        echo "$(date): âš ï¸ å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜: ${usage}%" >> $LOG_FILE
    else
        echo "$(date): âœ“ å†…å­˜ä½¿ç”¨ç‡æ­£å¸¸: ${usage}%" >> $LOG_FILE
    fi
}

# æ£€æŸ¥APIå¥åº·çŠ¶æ€
check_api_health() {
    local response=$(curl -s -o /dev/null -w "%{http_code}" http://localhost:18080/api/health)
    if [ $response -eq 200 ]; then
        echo "$(date): âœ“ APIå¥åº·æ£€æŸ¥é€šè¿‡" >> $LOG_FILE
    else
        echo "$(date): âœ— APIå¥åº·æ£€æŸ¥å¤±è´¥ (HTTP $response)" >> $LOG_FILE
    fi
}

# æ‰§è¡Œæ£€æŸ¥
echo "=== $(date) NOFX ç³»ç»Ÿç›‘æ§æ£€æŸ¥ ===" >> $LOG_FILE

check_service "åç«¯æœåŠ¡" "nofx-trading" "18080"
check_service "å‰ç«¯æœåŠ¡" "nofx-frontend" "13000"
check_port 18080 "åç«¯API"
check_port 13000 "å‰ç«¯Web"
check_disk
check_memory
check_api_health

echo "ç›‘æ§æ£€æŸ¥å®Œæˆ" >> $LOG_FILE
echo "" >> $LOG_FILE
```

### è®¾ç½®å®šæ—¶ç›‘æ§

```bash
# æ·»åŠ åˆ° crontab
crontab -e

# æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
*/5 * * * * /path/to/nofx/scripts/monitor.sh

# æ¯å¤©ç”ŸæˆæŠ¥å‘Š
0 8 * * * /path/to/nofx/scripts/daily-report.sh
```

### Prometheus ç›‘æ§é…ç½®

åˆ›å»º `monitoring/prometheus.yml`:

```yaml
global:
  scrape_interval: 15s
  evaluation_interval: 15s

rule_files:
  - "nofx_rules.yml"

scrape_configs:
  - job_name: 'nofx-backend'
    static_configs:
      - targets: ['nofx:8080']
    metrics_path: '/api/metrics'
    scrape_interval: 30s

  - job_name: 'nofx-frontend'
    static_configs:
      - targets: ['nofx-frontend:80']
    metrics_path: '/metrics'
    scrape_interval: 30s

  - job_name: 'node-exporter'
    static_configs:
      - targets: ['node-exporter:9100']

alerting:
  alertmanagers:
    - static_configs:
        - targets:
          - alertmanager:9093
```

åˆ›å»º `monitoring/nofx_rules.yml`:

```yaml
groups:
  - name: nofx_alerts
    rules:
      - alert: ServiceDown
        expr: up == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "NOFX æœåŠ¡ {{ $labels.job }} å·²åœæ­¢"
          description: "NOFX æœåŠ¡ {{ $labels.job }} å·²ç»åœæ­¢è¶…è¿‡1åˆ†é’Ÿ"

      - alert: HighMemoryUsage
        expr: (node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes * 100 > 85
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜"
          description: "å†…å­˜ä½¿ç”¨ç‡ {{ $value | printf \"%.2f\" }}% è¶…è¿‡85%"

      - alert: HighDiskUsage
        expr: (node_filesystem_size_bytes - node_filesystem_avail_bytes) / node_filesystem_size_bytes * 100 > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "ç£ç›˜ä½¿ç”¨ç‡è¿‡é«˜"
          description: "ç£ç›˜ {{ $labels.mountpoint }} ä½¿ç”¨ç‡ {{ $value | printf \"%.2f\" }}% è¶…è¿‡80%"

      - alert: APIHighLatency
        expr: http_request_duration_seconds{quantile="0.95"} > 2
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "APIå“åº”å»¶è¿Ÿè¿‡é«˜"
          description: "API 95åˆ†ä½å»¶è¿Ÿ {{ $value | printf \"%.2f\" }}s è¶…è¿‡2ç§’"
```

## ğŸ’¾ æ•°æ®å¤‡ä»½

### è‡ªåŠ¨å¤‡ä»½è„šæœ¬

åˆ›å»º `scripts/backup.sh`:

```bash
#!/bin/bash

# NOFX æ•°æ®å¤‡ä»½è„šæœ¬
BACKUP_DIR="/path/to/nofx/backups"
DATE=$(date +%Y%m%d_%H%M%S)
RETENTION_DAYS=30

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# å¤‡ä»½é…ç½®æ–‡ä»¶
echo "å¤‡ä»½é…ç½®æ–‡ä»¶..."
tar -czf "$BACKUP_DIR/config_$DATE.tar.gz" \
    config.json \
    .env \
    prompts/ \
    decision_logs/ \
    --exclude='*.log'

# å¤‡ä»½æ•°æ®åº“
echo "å¤‡ä»½æ•°æ®åº“..."
cp config.db "$BACKUP_DIR/config_$DATE.db"

# å‹ç¼©æ•°æ®åº“å¤‡ä»½
gzip "$BACKUP_DIR/config_$DATE.db"

# å¤‡ä»½Docker volumesï¼ˆå¯é€‰ï¼‰
echo "å¤‡ä»½Dockeræ•°æ®..."
docker run --rm -v nofx_grafana_data:/data -v $BACKUP_DIR:/backup \
    alpine tar czf /backup/grafana_$DATE.tar.gz -C /data .
docker run --rm -v nofx_prometheus_data:/data -v $BACKUP_DIR:/backup \
    alpine tar czf /backup/prometheus_$DATE.tar.gz -C /data .

# æ¸…ç†è¿‡æœŸå¤‡ä»½
echo "æ¸…ç†è¿‡æœŸå¤‡ä»½..."
find $BACKUP_DIR -name "*.tar.gz" -mtime +$RETENTION_DAYS -delete
find $BACKUP_DIR -name "*.db.gz" -mtime +$RETENTION_DAYS -delete

# éªŒè¯å¤‡ä»½
echo "éªŒè¯å¤‡ä»½å®Œæ•´æ€§..."
for file in "$BACKUP_DIR"/*_$DATE.tar.gz; do
    if tar -tzf "$file" > /dev/null; then
        echo "âœ“ $file å¤‡ä»½æˆåŠŸ"
    else
        echo "âœ— $file å¤‡ä»½å¤±è´¥"
        exit 1
    fi
done

echo "å¤‡ä»½å®Œæˆ: $BACKUP_DIR/nofx_backup_$DATE"
echo "å¤‡ä»½å¤§å°: $(du -sh $BACKUP_DIR/*_$DATE* | awk '{sum+=$1} END {print sum}')"

# å¯é€‰ï¼šä¸Šä¼ åˆ°äº‘å­˜å‚¨
# aws s3 sync $BACKUP_DIR s3://your-backup-bucket/nofx/
```

### è®¾ç½®å®šæ—¶å¤‡ä»½

```bash
# æ·»åŠ åˆ° crontab
crontab -e

# æ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½
0 2 * * * /path/to/nofx/scripts/backup.sh

# æ¯å‘¨æ—¥å®Œæ•´å¤‡ä»½
0 3 * * 0 /path/to/nofx/scripts/full-backup.sh
```

### æ¢å¤æµç¨‹

åˆ›å»º `scripts/restore.sh`:

```bash
#!/bin/bash

# NOFX æ•°æ®æ¢å¤è„šæœ¬
BACKUP_DIR="/path/to/nofx/backups"

if [ $# -eq 0 ]; then
    echo "ä½¿ç”¨æ–¹æ³•: $0 <å¤‡ä»½æ—¥æœŸ>"
    echo "å¯ç”¨å¤‡ä»½:"
    ls -1 $BACKUP_DIR/*.tar.gz | sed 's/.*\(.*_\)\(.*\)\.tar\.gz/\2/'
    exit 1
fi

BACKUP_DATE=$1

# åœæ­¢æœåŠ¡
echo "åœæ­¢æœåŠ¡..."
docker-compose down

# å¤‡ä»½å½“å‰æ•°æ®
echo "å¤‡ä»½å½“å‰æ•°æ®..."
mv config.db config.db.backup
mv config.json config.json.backup

# æ¢å¤é…ç½®æ–‡ä»¶
echo "æ¢å¤é…ç½®æ–‡ä»¶..."
tar -xzf "$BACKUP_DIR/config_$BACKUP_DATE.tar.gz"

# æ¢å¤æ•°æ®åº“
echo "æ¢å¤æ•°æ®åº“..."
gunzip -c "$BACKUP_DIR/config_$BACKUP_DATE.db.gz" > config.db

# é‡å¯æœåŠ¡
echo "é‡å¯æœåŠ¡..."
docker-compose up -d

# éªŒè¯æ¢å¤
echo "éªŒè¯æ¢å¤..."
sleep 30
curl -f http://localhost:18080/api/health

if [ $? -eq 0 ]; then
    echo "âœ“ æ¢å¤æˆåŠŸ"
    # åˆ é™¤ä¸´æ—¶å¤‡ä»½æ–‡ä»¶
    rm config.db.backup config.json.backup
else
    echo "âœ— æ¢å¤å¤±è´¥ï¼Œå›æ»š"
    # å›æ»šæ“ä½œ
    docker-compose down
    mv config.db.backup config.db
    mv config.json.backup config.json
    docker-compose up -d
fi
```

## ğŸ“ æ—¥å¿—ç®¡ç†

### æ—¥å¿—è½®è½¬é…ç½®

åˆ›å»º `/etc/logrotate.d/nofx`:

```
/path/to/nofx/logs/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 root root
    postrotate
        docker kill -s USR1 nofx-trading
    endscript
}

/path/to/nofx/decision_logs/*.log {
    daily
    missingok
    rotate 90
    compress
    delaycompress
    notifempty
    create 644 root root
}
```

### æ—¥å¿—èšåˆè„šæœ¬

åˆ›å»º `scripts/log-analyzer.sh`:

```bash
#!/bin/bash

# NOFX æ—¥å¿—åˆ†æè„šæœ¬
LOG_DIR="/path/to/nofx/decision_logs"
REPORT_FILE="/path/to/nofx/reports/daily_report_$(date +%Y%m%d).html"

# åˆ›å»ºæŠ¥å‘Šç›®å½•
mkdir -p $(dirname $REPORT_FILE)

# åˆ†æäº¤æ˜“æ—¥å¿—
echo "ç”Ÿæˆäº¤æ˜“æ—¥å¿—æŠ¥å‘Š..."

cat > $REPORT_FILE << EOF
<!DOCTYPE html>
<html>
<head>
    <title>NOFX æ—¥æŠ¥å‘Š - $(date +%Y-%m-%d)</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .header { background: #f0f0f0; padding: 20px; border-radius: 5px; }
        .section { margin: 20px 0; }
        .error { color: red; }
        .success { color: green; }
        .warning { color: orange; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <div class="header">
        <h1>NOFX äº¤æ˜“ç³»ç»Ÿæ—¥å¿—æŠ¥å‘Š</h1>
        <p>ç”Ÿæˆæ—¶é—´: $(date)</p>
    </div>

    <div class="section">
        <h2>ä»Šæ—¥äº¤æ˜“æ¦‚è§ˆ</h2>
        <table>
            <tr><th>äº¤æ˜“å‘˜</th><th>äº¤æ˜“æ¬¡æ•°</th><th>æˆåŠŸç‡</th><th>ç›ˆäº</th></tr>
EOF

# åˆ†æå„äº¤æ˜“å‘˜è¡¨ç°
for trader_dir in $LOG_DIR/*/; do
    if [ -d "$trader_dir" ]; then
        trader=$(basename "$trader_dir")
        today_log=$(find "$trader_dir" -name "*.log" -newermt "$(date -d 'today 00:00:00')" | head -1)

        if [ -f "$today_log" ]; then
            # ç»Ÿè®¡äº¤æ˜“æ•°æ®
            trades=$(grep -c "TRADE_EXECUTED" "$today_log" 2>/dev/null || echo 0)
            success=$(grep -c "TRADE_SUCCESS" "$today_log" 2>/dev/null || echo 0)
            profit=$(grep "PROFIT:" "$today_log" | awk '{sum+=$NF} END {print sum+0}')

            success_rate=0
            if [ $trades -gt 0 ]; then
                success_rate=$((success * 100 / trades))
            fi

            echo "<tr><td>$trader</td><td>$trades</td><td>$success_rate%</td><td>$profit</td></tr>" >> $REPORT_FILE
        fi
    fi
done

cat >> $REPORT_FILE << EOF
        </table>
    </div>

    <div class="section">
        <h2>é”™è¯¯æ—¥å¿—</h2>
        <pre>
EOF

# æ”¶é›†ä»Šæ—¥é”™è¯¯
grep -h "ERROR\|FATAL" $LOG_DIR/*/*.log 2>/dev/null | grep "$(date +%Y-%m-%d)" | head -20 >> $REPORT_FILE

cat >> $REPORT_FILE << EOF
        </pre>
    </div>

    <div class="section">
        <h2>ç³»ç»ŸçŠ¶æ€</h2>
        <ul>
            <li>ç£ç›˜ä½¿ç”¨: $(df -h / | awk 'NR==2 {print $5}')</li>
            <li>å†…å­˜ä½¿ç”¨: $(free -h | awk 'NR==2{printf "%.1f%%", $3*100/$2}')</li>
            <li>è¿è¡Œæ—¶é—´: $(uptime -p)</li>
            <li>DockerçŠ¶æ€: $(docker ps --format "table {{.Names}}\t{{.Status}}" | grep nofx)</li>
        </ul>
    </div>
</body>
</html>
EOF

echo "æŠ¥å‘Šå·²ç”Ÿæˆ: $REPORT_FILE"

# å‘é€é‚®ä»¶æŠ¥å‘Šï¼ˆå¯é€‰ï¼‰
# mail -s "NOFX æ—¥æŠ¥å‘Š - $(date +%Y-%m-%d)" your-email@example.com < $REPORT_FILE
```

## ğŸ”§ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜è¯Šæ–­

åˆ›å»º `scripts/diagnose.sh`:

```bash
#!/bin/bash

# NOFX ç³»ç»Ÿè¯Šæ–­è„šæœ¬
echo "=== NOFX ç³»ç»Ÿè¯Šæ–­æŠ¥å‘Š ==="
echo "ç”Ÿæˆæ—¶é—´: $(date)"
echo ""

# 1. æ£€æŸ¥DockerçŠ¶æ€
echo "1. Docker çŠ¶æ€æ£€æŸ¥"
echo "DockeræœåŠ¡çŠ¶æ€:"
systemctl is-active docker
echo ""
echo "è¿è¡Œçš„å®¹å™¨:"
docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"
echo ""

# 2. æ£€æŸ¥ç«¯å£å ç”¨
echo "2. ç«¯å£å ç”¨æ£€æŸ¥"
netstat -tlnp | grep -E ":(13000|18080|3001|9090)" || echo "ç›®æ ‡ç«¯å£æœªè¢«å ç”¨"
echo ""

# 3. æ£€æŸ¥ç£ç›˜ç©ºé—´
echo "3. ç£ç›˜ç©ºé—´æ£€æŸ¥"
df -h | grep -E "(/$|/var|/opt)"
echo ""

# 4. æ£€æŸ¥å†…å­˜ä½¿ç”¨
echo "4. å†…å­˜ä½¿ç”¨æ£€æŸ¥"
free -h
echo ""
echo "å†…å­˜ä½¿ç”¨æœ€é«˜çš„è¿›ç¨‹:"
ps aux --sort=-%mem | head -10
echo ""

# 5. æ£€æŸ¥ç½‘ç»œè¿æ¥
echo "5. ç½‘ç»œè¿æ¥æ£€æŸ¥"
echo "APIè¿é€šæ€§:"
curl -s -o /dev/null -w "HTTPå“åº”ç : %{http_code}, å“åº”æ—¶é—´: %{time_total}s\n" http://localhost:18080/api/health
echo "å‰ç«¯è¿é€šæ€§:"
curl -s -o /dev/null -w "HTTPå“åº”ç : %{http_code}, å“åº”æ—¶é—´: %{time_total}s\n" http://localhost:13000
echo ""

# 6. æ£€æŸ¥æ—¥å¿—é”™è¯¯
echo "6. é”™è¯¯æ—¥å¿—æ£€æŸ¥"
echo "å®¹å™¨é”™è¯¯æ—¥å¿—:"
docker logs nofx-trading 2>&1 | tail -20 | grep -i error || echo "æ— é”™è¯¯æ—¥å¿—"
echo ""
echo "å‰ç«¯é”™è¯¯æ—¥å¿—:"
docker logs nofx-frontend 2>&1 | tail -20 | grep -i error || echo "æ— é”™è¯¯æ—¥å¿—"
echo ""

# 7. æ£€æŸ¥æ•°æ®åº“
echo "7. æ•°æ®åº“æ£€æŸ¥"
if [ -f "config.db" ]; then
    echo "æ•°æ®åº“æ–‡ä»¶å¤§å°: $(du -sh config.db)"
    echo "æ•°æ®åº“è¡¨ç»“æ„:"
    sqlite3 config.db ".tables"
    echo "äº¤æ˜“å‘˜æ•°é‡:"
    sqlite3 config.db "SELECT COUNT(*) FROM traders;"
    echo "ç”¨æˆ·æ•°é‡:"
    sqlite3 config.db "SELECT COUNT(*) FROM users;"
else
    echo "æ•°æ®åº“æ–‡ä»¶ä¸å­˜åœ¨"
fi
echo ""

# 8. æ£€æŸ¥é…ç½®æ–‡ä»¶
echo "8. é…ç½®æ–‡ä»¶æ£€æŸ¥"
echo "config.json è¯­æ³•:"
jq empty config.json 2>&1 || echo "config.json è¯­æ³•é”™è¯¯"
echo ".env æ–‡ä»¶å­˜åœ¨: $([ -f .env ] && echo 'æ˜¯' || echo 'å¦')"
echo ""

# 9. æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½
echo "9. ç³»ç»Ÿè´Ÿè½½"
echo "CPUè´Ÿè½½:"
uptime
echo ""
echo "ç£ç›˜IO:"
iostat -x 1 1 | tail -n +4
echo ""

# 10. æ£€æŸ¥å®‰å…¨é…ç½®
echo "10. å®‰å…¨é…ç½®æ£€æŸ¥"
echo "é˜²ç«å¢™çŠ¶æ€:"
ufw status 2>/dev/null || iptables -L -n | head -10
echo ""

echo "=== è¯Šæ–­å®Œæˆ ==="
```

### æ•…éšœå¤„ç†æµç¨‹

#### æœåŠ¡æ— æ³•å¯åŠ¨
```bash
# 1. æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep :13000
netstat -tlnp | grep :18080

# 2. æ£€æŸ¥Dockeræ—¥å¿—
docker logs nofx-trading
docker logs nofx-frontend

# 3. é‡æ–°æ„å»ºé•œåƒ
docker-compose down
docker-compose build --no-cache
docker-compose up -d

# 4. æ£€æŸ¥é…ç½®æ–‡ä»¶
jq empty config.json
```

#### APIå“åº”æ…¢
```bash
# 1. æ£€æŸ¥ç³»ç»Ÿèµ„æº
top
htop

# 2. æ£€æŸ¥ç½‘ç»œå»¶è¿Ÿ
ping -c 4 localhost
curl -w "@curl-format.txt" -o /dev/null -s http://localhost:18080/api/health

# 3. æ£€æŸ¥æ•°æ®åº“æ€§èƒ½
sqlite3 config.db "EXPLAIN QUERY PLAN SELECT * FROM traders;"

# 4. é‡å¯æœåŠ¡
docker-compose restart nofx
```

#### æ•°æ®åº“æŸå
```bash
# 1. æ£€æŸ¥æ•°æ®åº“å®Œæ•´æ€§
sqlite3 config.db "PRAGMA integrity_check;"

# 2. å¤‡ä»½æŸåçš„æ•°æ®åº“
cp config.db config.db.corrupted

# 3. å°è¯•æ¢å¤
sqlite3 config.db ".recover" | sqlite3 config.db.recovered

# 4. å¦‚æ¢å¤å¤±è´¥ï¼Œä»å¤‡ä»½æ¢å¤
./scripts/restore.sh latest
```

## âš¡ æ€§èƒ½ä¼˜åŒ–

### ç³»ç»Ÿä¼˜åŒ–

```bash
# 1. å†…æ ¸å‚æ•°ä¼˜åŒ–
echo 'net.core.somaxconn = 65535' >> /etc/sysctl.conf
echo 'net.ipv4.tcp_max_syn_backlog = 65535' >> /etc/sysctl.conf
echo 'vm.swappiness = 10' >> /etc/sysctl.conf
sysctl -p

# 2. æ–‡ä»¶æè¿°ç¬¦é™åˆ¶
echo '* soft nofile 65535' >> /etc/security/limits.conf
echo '* hard nofile 65535' >> /etc/security/limits.conf

# 3. Docker ä¼˜åŒ–
echo '{"live-restore": true}' > /etc/docker/daemon.json
systemctl restart docker
```

### åº”ç”¨ä¼˜åŒ–

#### æ•°æ®åº“ä¼˜åŒ–
```sql
-- SQLite ä¼˜åŒ–è®¾ç½®
PRAGMA journal_mode = WAL;
PRAGMA synchronous = NORMAL;
PRAGMA cache_size = 10000;
PRAGMA temp_store = memory;
PRAGMA mmap_size = 268435456; -- 256MB
```

#### Goåº”ç”¨ä¼˜åŒ–
```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
export GOGC=100
export GOMAXPROCS=4
export GOMEMLIMIT=2GiB
```

## ğŸ” å®‰å…¨åŠ å›º

### SSL/TLS é…ç½®

```bash
# ç”Ÿæˆè‡ªç­¾åè¯ä¹¦
mkdir -p nginx/ssl
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
    -keyout nginx/ssl/self.key \
    -out nginx/ssl/self.crt \
    -subj "/C=CN/ST=State/L=City/O=Organization/CN=localhost"

# æˆ–è€…ä½¿ç”¨ Let's Encrypt
certbot --nginx -d your-domain.com
```

### è®¿é—®æ§åˆ¶

```nginx
# Nginx åŸºç¡€è®¤è¯
htpasswd -c /etc/nginx/.htpasswd admin

# IP ç™½åå•
location /api/ {
    allow 127.0.0.1;
    allow 10.0.0.0/8;
    allow 192.168.0.0/16;
    deny all;
    # ... å…¶ä»–é…ç½®
}
```

### å®‰å…¨æ‰«æ

```bash
# Docker å®‰å…¨æ‰«æ
docker run --rm -v /var/run/docker.sock:/var/run/docker.sock \
    aquasec/trivy image nofx:latest

# ç«¯å£æ‰«æ
nmap -sS -O localhost

# æ¼æ´æ‰«æ
lynis audit system
```

## ğŸ“… ç»´æŠ¤è®¡åˆ’

### æ—¥å¸¸ç»´æŠ¤ï¼ˆæ¯æ—¥ï¼‰

- [ ] æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€
- [ ] æŸ¥çœ‹ç³»ç»Ÿèµ„æºä½¿ç”¨
- [ ] æ£€æŸ¥é”™è¯¯æ—¥å¿—
- [ ] éªŒè¯å¤‡ä»½å®Œæ•´æ€§
- [ ] ç›‘æ§äº¤æ˜“è¡¨ç°

### å‘¨æœŸç»´æŠ¤ï¼ˆæ¯å‘¨ï¼‰

- [ ] æ›´æ–°ç³»ç»Ÿè¡¥ä¸
- [ ] æ¸…ç†æ—¥å¿—æ–‡ä»¶
- [ ] æ€§èƒ½åˆ†ææŠ¥å‘Š
- [ ] å®‰å…¨æ£€æŸ¥
- [ ] å¤‡ä»½éªŒè¯

### æœˆåº¦ç»´æŠ¤ï¼ˆæ¯æœˆï¼‰

- [ ] å…¨é¢ç³»ç»Ÿæ›´æ–°
- [ ] æ•°æ®åº“ä¼˜åŒ–
- [ ] å®‰å…¨å®¡è®¡
- [ ] å®¹é‡è§„åˆ’
- [ ] ç¾éš¾æ¢å¤æ¼”ç»ƒ

### ç´§æ€¥å“åº”æµç¨‹

1. **å‘Šè­¦è§¦å‘** â†’ ç«‹å³å“åº”ï¼ˆ5åˆ†é’Ÿå†…ï¼‰
2. **åˆæ­¥è¯Šæ–­** â†’ ç¡®å®šå½±å“èŒƒå›´ï¼ˆ15åˆ†é’Ÿå†…ï¼‰
3. **ä¸´æ—¶ä¿®å¤** â†’ æ¢å¤æœåŠ¡ï¼ˆ1å°æ—¶å†…ï¼‰
4. **æ ¹å› åˆ†æ** â†’ å½»åº•è§£å†³ï¼ˆ24å°æ—¶å†…ï¼‰
5. **å¤ç›˜æ€»ç»“** â†’ é¢„é˜²æªæ–½ï¼ˆä¸€å‘¨å†…ï¼‰

### è”ç³»ä¿¡æ¯

- **è¿ç»´å›¢é˜Ÿ**: ops@yourcompany.com
- **ç´§æ€¥ç”µè¯**: +86-xxx-xxxx-xxxx
- **å€¼ç­è¡¨**: [å€¼ç­å®‰æ’é“¾æ¥]

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å®‰è£…éƒ¨ç½²æŒ‡å—](docs/getting-started/README.md)
- [å®‰å…¨æœ€ä½³å®è·µ](SECURITY.md)
- [API æ–‡æ¡£](docs/api/README.md)
- [æ•…éšœæ’æŸ¥æ‰‹å†Œ](docs/guides/TROUBLESHOOTING.md)

---

**æœ€åæ›´æ–°**: 2025-11-04
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**ç»´æŠ¤äººå‘˜**: è¿ç»´å›¢é˜Ÿ